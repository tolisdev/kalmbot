const WorkerPool = require('workerpool')

class JsonPool {
	constructor() {
		this.pool = WorkerPool.pool(
			__dirname + '/jsonScript.js', {
			maxWorkers: 4,
			workerType: 'thread'
		})
	}

	parse(data) {
		return this.pool.exec('parse', [data]).then(res => {
			if (!this.pool.tasks.length) this.pool.terminate()

			return res
		}).catch(rej => {
			if (!this.pool.tasks.length) this.pool.terminate()

			throw rej
		})
	}

	stringify(data) {
		return this.pool.exec('stringify', [data]).then(res => {
			if (!this.pool.tasks.length) this.pool.terminate()

			return res
		}).catch(rej => {
			if (!this.pool.tasks.length) this.pool.terminate()

			throw rej
		})
	}
}

module.exports = JsonPool