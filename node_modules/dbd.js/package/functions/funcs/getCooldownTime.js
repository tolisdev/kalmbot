const ms = require("parse-ms") 
const parse = require("ms-parser") 

module.exports = async d => {
    const code =d.command.code 
    
    const r = code.split("$getCooldownTime").length - 1 
    
    const inside = code.split("$getCooldownTime[")[r].split("]")[0] 
    
    const [type, name, id, MS = "no"] = inside.split(";") 
    
    const types = {
        globalUser: id, 
        user: `${d.message.guild.id}_${id}`, 
        server: id 
    }[type] 
    
    if (!types) return d.error(`❌ Invalid cooldown type on \`$getCooldownTime[${inside}]\``) 
    
    const cd = await d.client.db.findOne({
        variable: `cooldowns`, 
        varID: types 
    })
    
    return {
        code: code.replaceLast(`$getCooldownTime[${inside}]`, cd && cd.value - Date.now() > 0 ? MS === "no" ? parse(Object.entries(ms(cd.value - Date.now())).filter((x, y) => y < 4 && x[1]).map((x, y) => x[1] + x[0][0]).join("")).string : cd.value - Date.now() : 0)
    }
}