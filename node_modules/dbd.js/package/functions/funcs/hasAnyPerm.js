const permissions = require("../../utils/permissions") 

module.exports = async d => {
    const code = d.command.code 
    
    const r = code.split("$hasAnyPerm").length - 1 
    
    const inside = code.split("$hasAnyPerm[")[r].split("]")[0] 
    
    const fields = inside.split(";") 
    
    const userID = (Number(fields[0]) && fields[0].length > 17 && fields[0].length <= 19) ? fields.shift() : d.message.author.id 
    
    const member = await d.message.guild.members.fetch(userID).catch(err => null)
        
    if (!member) return d.error(`❌ Invalid user ID in \`$hasAnyPerm[${inside}]\``) 
    
    const perms = fields.map(p => permissions[p])
    
    if (perms.includes(undefined)) return d.error(`Invalid permission given in \`$hasAnyPerm[${inside}]\``) 
    
    return {
        code: code.replaceLast(`$hasAnyPerm[${inside}]`, member.permissions.any(perms))
    }
}