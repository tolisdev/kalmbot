const Discord = require("discord.js")

module.exports = async d => {
    const code = d.command.code
    
    const r = code.split("$attachment[").length - 1 
    
    const inside = code.split("$attachment[")[r].split("]")[0] 
    
    const [url, name = "image.webp", type = "url" ] = inside.split(";") 
    
    const attachment = new Discord.MessageAttachment(type === "buffer" ? Buffer.from(url.addBrackets(), 'binary') : url.addBrackets(), name.addBrackets())
    
    return {
        code: code.replaceLast(`$attachment[${code.split("$attachment[")[r].split("]")[0]}]`, ""),
        embed: d.embed.attachFiles(attachment) 
    }
}